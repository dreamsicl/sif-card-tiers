<div class="container-fluid row">
    <div class="col-xs-2" id="filters-md-screens" master>
        <div class="row">
            <div class="btn-group-vertical col-xs-12" uib-tooltip="Compare by skill" tooltip-placement="top">
                <label class="btn btn-success btn-sm" ng-model="filters.su" ng-click="filterCards()" uib-btn-checkbox>Score Up</label>
                <label class="btn btn-success btn-sm" ng-model="filters.pl" ng-click="filterCards()" uib-btn-checkbox>Perfect Lock</label>
                <label class="btn btn-success btn-sm" ng-model="filters.hl" ng-click="filterCards()" uib-btn-checkbox>Healer</label>
            </div>

            <div class="btn-group btn-group-justified">
                <label class="btn btn-danger btn-sm" ng-click="resetFilters()">Reset Filters</label>
            </div>

            <div class="btn-group btn-group-justified">
                <label class="btn btn-default btn-sm" ng-model="filters.heel" ng-click="toggleHeel()" uib-btn-checkbox>Heel?</label>
            </div>

            <div class="btn-group-vertical col-xs-12">
                <label class="btn btn-default btn-sm" ng-model="filters.displayImg" ng-click="setLocalStorageFilters()" uib-btn-checkbox>Display imgs?</label>
            </div>

            <div class="btn-group-vertical col-xs-12">
                <label class="btn btn-default btn-sm" ng-model="filters.idlz" ng-click="setLocalStorageFilters()" uib-btn-checkbox>Idolized?</label>
            </div>

            <div class="btn-group btn-group-justified" uib-tooltip="Server" tooltip-placement="top">
                <label class="btn btn-info btn-sm" ng-model="filters.server" ng-click="filterCards()" uib-btn-radio="'jp'">JP</label>
                <label class="btn btn-info btn-sm" ng-model="filters.server" ng-click="filterCards()" uib-btn-radio="'en'">EN</label>
            </div>

            <div uib-tooltip="Attribute" tooltip-placement="top">
                <div class="btn-group btn-group-justified col-xs-12 no-padding" style="margin-bottom:0px">
                    <label class="btn btn-info btn-sm" style="border-bottom-left-radius:0" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'all'">All</label>
                    <label class="btn btn-info btn-sm" style="border-bottom-right-radius:0" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'smile'">Smile</label>
                </div>

                <div class="btn-group btn-group-justified col-xs-12 no-padding">
                    <label class="btn btn-info btn-sm" style="border-top-left-radius:0" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'pure'">Pure</label>
                    <label class="btn btn-info btn-sm" style="border-top-right-radius:0" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'cool'">Cool</label>
                </div>
            </div>

            <div class="btn-group btn-group-justified col-xs-12" uib-tooltip="Main unit" tooltip-placement="top">
                <label class="btn btn-info btn-sm" ng-model="filters.muse" ng-click="filterCards()" uib-btn-checkbox>Muse</label>
                <label class="btn btn-info btn-sm" ng-model="filters.aqours" ng-click="filterCards()" uib-btn-checkbox>Aqours</label>
            </div>

            <div class="btn-group btn-group-justified col-xs-12" uib-tooltip="Rarity" tooltip-placement="top">
                <label class="btn btn-info btn-sm" ng-model="filters.sr" ng-click="toggleBool(filters.sr);filterCards()" uib-btn-checkbox>SR</label>
                <label class="btn btn-info btn-sm" ng-model="filters.ssr" ng-click="toggleBool(filters.ssr);filterCards()" uib-btn-checkbox>SSR</label>
                <label class="btn btn-info btn-sm" ng-model="filters.ur" ng-click="toggleBool(filters.ur);filterCards()" uib-btn-checkbox>UR</label>
            </div>

            <div class="btn-group btn-group-dropdown dropup col-xs-12 no-padding" style="margin-bottom: 10px;" uib-dropdown>
                <button type="button" class="btn btn-sm btn-info name">Origin</button>
                <button type="button" class="btn btn-sm btn-info drop" uib-dropdown-toggle>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="split-button">
                    <li role="menuitem">
                        <a ng-model="filters.premium" ng-click="filterCards()" uib-btn-checkbox>Premium</a>
                    </li>
                    <li role="menuitem">
                        <a ng-model="filters.event" ng-click="filterCards()" uib-btn-checkbox>Event</a>
                    </li>
                    <li role="menuitem">
                        <a ng-model="filters.promo" ng-click="filterCards()" uib-btn-checkbox>Promo</a>
                    </li>
                </ul>
            </div>

            <div class="btn-group btn-group-dropdown dropup col-xs-12 no-padding" style="margin-bottom: 10px;" uib-dropdown>
                <button type="button" class="btn btn-sm btn-info name">Subunit</button>
                <button type="button" class="btn btn-sm btn-info drop" uib-dropdown-toggle>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="split-button">
                    <li role="menuitem">
                        <a ng-model="filters.subunit" ng-click="filterCards()" uib-btn-radio="'all'">All</a>
                    </li>
                    <li class="divider"></li>
                    <li role="menuitem">
                        <a ng-model="filters.subunit" ng-click="filterCards()" uib-btn-radio="'lily white'">lily white</a>
                    </li>
                    <li role="menuitem">
                        <a ng-model="filters.subunit" ng-click="filterCards()" uib-btn-radio="'Printemps'">Printemps</a>
                    </li>
                    <li role="menuitem">
                        <a ng-model="filters.subunit" ng-click="filterCards()" uib-btn-radio="'BiBi'">BiBi</a>
                    </li>
                    <li class="divider"></li>
                    <li role="menuitem">
                        <a ng-model="filters.subunit" ng-click="filterCards()" uib-btn-radio="'AZALEA'">AZALEA</a>
                    </li>
                    <li role="menuitem">
                        <a ng-model="filters.subunit" ng-click="filterCards()" uib-btn-radio="'CYaRon'">CYaRon</a>
                    </li>
                    <li role="menuitem">
                        <a ng-model="filters.subunit" ng-click="filterCards()" uib-btn-radio="'Guilty Kiss'">Guilty Kiss</a>
                    </li>
                </ul>
            </div>

            <div class="btn-group btn-group-dropdown dropup col-xs-12 no-padding" style="margin-bottom: 10px;" uib-dropdown>
                <button type="button" class="btn btn-sm btn-info name">Year</button>
                <button type="button" class="btn btn-sm btn-info drop" uib-dropdown-toggle>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="split-button">
                    <li role="menuitem">
                        <a ng-model="filters.year" ng-click="filterCards()" uib-btn-radio="'all'">All</a>
                    </li>
                    <li class="divider"></li>
                    <li role="menuitem">
                        <a ng-model="filters.year" ng-click="filterCards()" uib-btn-radio="'1'">First</a>
                    </li>
                    <li role="menuitem">
                        <a ng-model="filters.year" ng-click="filterCards()" uib-btn-radio="'2'">Second</a>
                    </li>
                    <li role="menuitem">
                        <a ng-model="filters.year" ng-click="filterCards()" uib-btn-radio="'3'">Third</a>
                    </li>
                </ul>
            </div>

            <small class="col-xs-12">
                Showing
                <b>{{filtered.length}}</b>
                of
                <b>{{$root.Cards.length}}</b>
                total cards.
            </small>
        </div>
    </div>

    <div id="search_table" class="container-fluid col-xs-10">

        <div id="search" class="row">

            <div class="col-xs-4 no-padding">
                <div class="input-group input-group-sm">
                    <span
                        class="input-group-addon"
                        style="cursor: help"
                        popover-append-to-body="true"
                        popover-trigger="'mouseenter'"
                        popover-placement="top-left"
                        uib-popover="Terms include: girl, attribute, skill type, main unit, subunit, and English schoolido.lu set name.">
                        <i class="fa fa-search"></i>
                    </span>
                    <input type="text" class="form-control" ng-model="search" ng-change="updateSearch()" placeholder="search by card" uib-typeahead="type for type in $root.Typeahead | filter:$viewValue | limitTo:8">
                </div>
            </div>

            <div class="col-xs-2 no-padding" style="padding-left: 3px">
                <div class="input-group input-group-sm">
                    <span class="input-group-addon" style="cursor: help" popover-append-to-body="true" popover-trigger="'mouseenter'" popover-placement="top" uib-popover="Number of notes in song for skill evaluation">
                        <i class="fa fa-music"></i>
                    </span>
                    <input type="number" class="form-control" ng-model="song.notes" ng-change="updateSong()" popover-trigger="'mouseenter'" placeholder="song length (notes)">
                </div>
            </div>
            <div class="col-xs-2 no-padding" style="padding-left: 3px">
                <div class="input-group input-group-sm">
                    <span class="input-group-addon" style="cursor: help" popover-append-to-body="true" popover-trigger="'mouseenter'" popover-placement="top" uib-popover="Number of seconds in song for skill evaluation">
                        <i class="fa fa-clock-o"></i>
                    </span>
                    <input type="number" class="form-control" ng-model="song.seconds" ng-change="updateSong()" popover-trigger="'mouseenter'" placeholder="song length (secs)">
                </div>
            </div>
            <div class="col-xs-2 no-padding" style="padding-left: 3px">
                <div class="input-group input-group-sm">
                    <span class="input-group-addon" style="cursor: help" popover-append-to-body="true" popover-trigger="'mouseenter'" popover-placement="top" uib-popover="Percent of perfects per song for skill evaluation">
                        <i class="fa fa-bolt"></i>
                    </span>
                    <input type="number" class="form-control" ng-model="song.perfects" ng-change="updateSong()" placeholder="perfects">
                </div>
            </div>
            <div class="col-xs-2 no-padding" style="padding-left: 3px">
                <div class="input-group input-group-sm">
                    <span class="input-group-addon" style="cursor: help" popover-append-to-body="true" popover-trigger="'mouseenter'" popover-placement="top-right" uib-popover="Number of star notes in song">
                        <i class="fa fa-star"></i>
                    </span>
                    <input type="number" class="form-control" ng-model="song.stars" ng-change="updateSong()" placeholder="star notes">
                </div>
            </div>
        </div>

        <div style="border: 1px solid #dfd7ca;border-radius: 3px; position: relative" class="row" bs-loading-overlay bs-loading-overlay-reference-id="all">
            <div class="table-container" ng-style="style">

                <table class="table table-striped" id="tbl">
                    <thead fix-head>
                        <tr ng-show="filtered.length!=0">
                            <th>Rank</th>
                            <th>Card Name</th>
                            <th class="num-header" ng-click="sortBy('id')">ID
                                <i ng-show="sort.desc && sort.type=='id'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='id'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" ng-click="sortBy('smile')">Smile
                                <i ng-show="sort.desc && sort.type.includes('smile')" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type.includes('smile')" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" ng-click="sortBy('pure')">Pure
                                <i ng-show="sort.desc && sort.type.includes('pure')" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type.includes('pure')" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" ng-click="sortBy('cool')">Cool
                                <i ng-show="sort.desc && sort.type.includes('cool')" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type.includes('cool')" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:90px" ng-click="sortBy('cScore')">C-Score
                                <i ng-show="sort.desc && sort.type.includes('cScore')" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type.includes('cScore')" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:90px" ng-click="sortBy('oScore')">O-Score
                                <i ng-show="sort.desc && sort.type.includes('oScore')" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type.includes('oScore')" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:100px" ng-click="sortBy('skill.avg')">Skill (Avg)
                                <i ng-show="sort.desc && sort.type=='skill.avg'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='skill.avg'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:100px" ng-click="sortBy('skill.best')">Skill (Best)
                                <i ng-show="sort.desc && sort.type=='skill.best'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='skill.best'" class="fa fa-chevron-up"></i>
                            </th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr ng-if="filtered.length==0">
                            <td colspan=15 style="word-wrap: normal">
                                <span class="text-danger">No cards found.</span>
                                <a style="cursor: pointer" ng-click="resetFilters()">Reset filters?</a>
                            </td>
                        </tr>
                        <tr ng-repeat="card in filtered = (cards | filter:search) | orderBy:sort.type:sort.desc:true track by $index">
                            <td>{{sort.desc ? $index+1 : filtered.length - $index}}</td>
                            <td class="name-display">
                                <div class="media">
                                    <div class="media-left"><img ng-if="filters.displayImg" ng-src="{{filters.idlz || card.is_promo ? card.round_card_idolized_image : card.round_card_image}}" class="display-image media-image">
                                    </div>
                                    <div class="media-body media-middle">
                                        <span
                                            uib-popover="This card's skill is dependent on team strength. C-Score, O-Score, and Score Up value may be innaccuate. See Info page for more detailed explanation."
                                            popover-title="Disclaimer"
                                            popover-trigger="'mouseenter'"
                                            popover-enable="card.full_name=='SR Animal Yazawa Nico'||card.full_name=='SR Health Committee Minami Kotori'||card.full_name=='SR Animal Kousaka Honoka'||card.full_name=='SR October Sonoda Umi'">
                                            <span ng-if="card.full_name=='SR Animal Yazawa Nico'||card.full_name=='SR Health Committee Minami Kotori'||card.full_name=='SR Animal Kousaka Honoka'||card.full_name=='SR October Sonoda Umi'">
                                                <i class="fa fa-info-circle"></i>
                                            </span>
                                            <a href="{{card.website_url}}" ng-class="{'text-smile': card.attribute=='Smile', 'text-pure': card.attribute=='Pure', 'text-cool': card.attribute=='Cool'}">
                                                <i ng-if="card.skill.type=='Score Up'" class="fa fa-level-up" uib-tooltip="Score Up"></i>
                                                <i ng-if="card.skill.type=='Healer'" class="fa fa-heart" uib-tooltip="Healer"></i>
                                                <i ng-if="card.skill.type=='Perfect Lock'" class="fa fa-lock" uib-tooltip="Perfect Lock"></i>
                                                <i ng-if="card.event" class="fa fa-star" uib-tooltip="Event Only"></i>
                                                {{card.full_name}}</a>
                                        </span>
                                    </div>
                                </div>
                            </td>
                            <td>{{card.id}}</td>
                            <td>{{filters.idlz ? card.idolized_maximum_statistics_smile : card.non_idolized_maximum_statistics_smile}}</td>
                            <td>{{filters.idlz ? card.idolized_maximum_statistics_pure : card.non_idolized_maximum_statistics_pure}}</td>
                            <td>{{filters.idlz ? card.idolized_maximum_statistics_cool : card.non_idolized_maximum_statistics_cool}}</td>
                            <td>
                                <span uib-popover="Cannot equip Heel to a card with >4 SIS Slots. Displaying C-Score w/ default optimized SIS." popover-trigger="'mouseenter'" popover-enable="filters.heel && card.skill.type=='Healer' && (card.rarity!='UR' || card.is_promo)">
                                    <i ng-if="filters.heel && card.skill.type=='Healer' && (card.rarity!='UR' || card.is_promo)" class="fa fa-warning text-danger"></i>
                                    {{displayScore(card, "c") | number:2}}</span>
                            </td>
                            <td>
                                <span
                                    uib-popover="Cannot equip Heel to a card with >4 SIS Slots. Displaying O-Score w/ default optimized SIS."
                                    popover-trigger="'mouseenter'"
                                    popover-enable="filters.heel && card.skill.type=='Healer' && ((!filters.idlz && card.rarity!='UR') || card.is_promo)">
                                    <i ng-if="filters.heel && card.skill.type=='Healer' && ((!filters.idlz && card.rarity!='UR') || card.is_promo)" class="fa fa-warning text-danger"></i>
                                    {{displayScore(card, "o") | number:2}}</span>
                            </td>
                            <td>
                                {{card.skill.avg |number:2}}
                                <i ng-if="card.skill.type=='Score Up' || (card.skill.type=='Healer' && filters.heel && !card.is_promo)" class="fa fa-level-up" uib-tooltip="Score Up"></i>
                                <i ng-if="card.skill.type=='Healer' && (!filters.heel || card.is_promo)" class="fa fa-heart" uib-tooltip="Healer"></i>
                                <i ng-if="card.skill.type=='Perfect Lock'" class="fa fa-lock" uib-tooltip="Perfect Lock"></i>
                            </td>
                            <td>{{card.skill.best |number:2}}
                                <i ng-if="card.skill.type=='Score Up' || (card.skill.type=='Healer' && filters.heel && !card.is_promo)" class="fa fa-level-up" uib-tooltip="Score Up"></i>
                                <i ng-if="card.skill.type=='Healer' && (!filters.heel || card.is_promo)" class="fa fa-heart" uib-tooltip="Healer"></i>
                                <i ng-if="card.skill.type=='Perfect Lock'" class="fa fa-lock" uib-tooltip="Perfect Lock"></i>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>
