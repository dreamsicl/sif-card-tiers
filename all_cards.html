<!-- TODO: search by year, tier organization, info page, functioning tabs -->
<div class="container-fluid row">
    <div class="hidden-md hidden-lg col-sm-12" id="filters-sm-screens">

        <div class="row">

            <div class="filter-group col-sm-12" uib-tooltip="Compare by Skill Type">
                <div class="btn-group btn-group-justified">

                    <label class="btn btn-success btn-sm" ng-model="filters.compare" ng-click="filterCards()" uib-btn-radio="'scorers'">Score Up</label>
                    <label class="btn btn-success btn-sm" ng-model="filters.compare" ng-click="filterCards()" uib-btn-radio="'perfect locks'">Perfect Lock</label>
                    <label class="btn btn-success btn-sm" ng-model="filters.compare" ng-click="filterCards()" uib-btn-radio="'healers'">Healer</label>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="filter-group col-sm-3">
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-danger btn-sm" ng-click="resetFilters()">Reset Filters</label>
                </div>
            </div>

            <div class="filter-group col-sm-3" uib-tooltip="Idolized?">
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-info btn-sm" ng-model="filters.idlz" ng-click="toggleIdlz()" uib-btn-radio="false">Unidolized</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.idlz" ng-click="toggleIdlz()" uib-btn-radio="true">Idolized</label>
                </div>
            </div>

            <div class="filter-group col-sm-3" uib-tooltip="Server">
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-info btn-sm" ng-model="filters.server" ng-click="filterCards()" uib-btn-radio="'jp'">Japan</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.server" ng-click="filterCards()" uib-btn-radio="'en'">Global</label>
                </div>
            </div>
            <div class="filter-group col-sm-3" uib-tooltip="Rarity">
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-info btn-sm" ng-model="filters.sr" ng-click="toggleBool(filters.sr);filterCards()" uib-btn-checkbox ng-required="filters.sr || filters.ssr || filters.ur">SR</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.ssr" ng-click="toggleBool(filters.ssr);filterCards()" uib-btn-checkbox ng-required="filters.sr || filters.ssr || filters.ur">SSR</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.ur" ng-click="toggleBool(filters.ur);filterCards()" uib-btn-checkbox ng-required="filters.sr || filters.ssr || filters.ur">UR</label>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="filter-group col-sm-5" uib-tooltip="Attribute">
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-info btn-sm" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'all'">All</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'smile'">Smile</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'pure'">Pure</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'cool'">Cool</label>
                </div>
            </div>

            <div class="filter-group col-sm-4" uib-tooltip="Origin">
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-info btn-sm" ng-model="filters.premium" ng-click="toggleBool(filters.premium);filterCards()" uib-btn-checkbox>Premium</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.event" ng-click="toggleBool(filters.event);filterCards()" uib-btn-checkbox>Event</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.promo" ng-click="toggleBool(filters.promo);filterCards()" uib-btn-checkbox>Promo</label>
                </div>
            </div>

            <div class="filter-group col-sm-3" uib-tooltip="Main Unit">
                <div class="btn-group btn-group-justified">
                    <label class="btn btn-info btn-sm" ng-model="filters.muse" ng-click="toggleBool(filters.muse);filterCards()" uib-btn-checkbox>Muse</label>
                    <label class="btn btn-info btn-sm" ng-model="filters.aqours" ng-click="toggleBool(filters.aqours);filterCards()" uib-btn-checkbox>Aqours</label>
                </div>
            </div>
        </div>

    </div>

    <div class="hidden-xs hidden-sm col-md-2 container-fluid" id="filters-md-screens" bs-affix>

        <div class="btn-group-vertical col-md-12">
            <label class="btn btn-success btn-sm" ng-model="filters.compare" ng-click="filterCards()" uib-btn-radio="'scorers'">Score Up</label>
            <label class="btn btn-success btn-sm" ng-model="filters.compare" ng-click="filterCards()" uib-btn-radio="'perfect locks'">Perfect Lock</label>
            <label class="btn btn-success btn-sm" ng-model="filters.compare" ng-click="filterCards()" uib-btn-radio="'healers'">Healer</label>
        </div>

        <div class="btn-group btn-group-justified">
            <label class="btn btn-danger btn-sm" ng-click="resetFilters()">Reset Filters</label>
        </div>

        <div class="btn-group btn-group-justified">
            <label class="btn btn-info btn-sm" ng-model="filters.server" ng-click="filterCards()" uib-btn-radio="'jp'">JP</label>
            <label class="btn btn-info btn-sm" ng-model="filters.server" ng-click="filterCards()" uib-btn-radio="'en'">EN</label>
        </div>

        <div class="btn-group btn-group-justified col-md-12 no-padding" style="margin-bottom:0px">
            <label class="btn btn-info btn-sm" style="border-bottom-left-radius:0" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'all'">All</label>
            <label class="btn btn-info btn-sm" style="border-bottom-right-radius:0" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'smile'">Smile</label>
        </div>
        <div class="btn-group btn-group-justified col-md-12 no-padding">
            <label class="btn btn-info btn-sm" style="border-top-left-radius:0" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'pure'">Pure</label>
            <label class="btn btn-info btn-sm" style="border-top-right-radius:0" ng-model="filters.attribute" ng-click="filterCards()" uib-btn-radio="'cool'">Cool</label>
        </div>
        <!-- FIXME -->
        <div class="btn-group-vertical col-md-12">
            <label class="btn btn-info btn-sm" ng-model="filters.idlz" ng-click="localStorageService.set('filters',filters.idlz)" uib-btn-checkbox>Idolized?</label>
        </div>

        <div class="btn-group btn-group-justified col-md-12">
            <label class="btn btn-info btn-sm" ng-model="filters.sr" ng-click="toggleBool(filters.sr);filterCards()" uib-btn-checkbox>SR</label>
            <label class="btn btn-info btn-sm" ng-model="filters.ssr" ng-click="toggleBool(filters.ssr);filterCards()" uib-btn-checkbox>SSR</label>
            <label class="btn btn-info btn-sm" ng-model="filters.ur" ng-click="toggleBool(filters.ur);filterCards()" uib-btn-checkbox>UR</label>
        </div>

        <div class="btn-group-vertical col-md-12">
            <label class="btn btn-info btn-sm" ng-model="filters.premium" ng-click="toggleBool(filters.premium);filterCards()" uib-btn-checkbox>Premium</label>
            <label class="btn btn-info btn-sm" ng-model="filters.event" ng-click="toggleBool(filters.event);filterCards()" uib-btn-checkbox>Event</label>
            <label class="btn btn-info btn-sm" ng-model="filters.promo" ng-click="toggleBool(filters.promo);filterCards()" uib-btn-checkbox>Promo</label>
        </div>

        <div class="btn-group-vertical col-md-12">
            <label class="btn btn-info btn-sm" ng-model="filters.muse" ng-click="toggleBool(filters.muse);filterCards()" uib-btn-checkbox>Muse</label>
            <label class="btn btn-info btn-sm" ng-model="filters.aqours" ng-click="toggleBool(filters.aqours);filterCards()" uib-btn-checkbox>Aqours</label>
        </div>
    </div>
<!-- TODO: affix header -->
    <div id="search_table" class="col-sm-12 col-md-10">
        <div id="search">
            <div class="input-group">
                <span class="input-group-addon">
                    <i class="glyphicon glyphicon-search"></i>
                </span>
                <input type="text" class="form-control" ng-model="search" placeholder="search by card" uib-typeahead="type for type in $root.Typeahead | filter:$viewValue | limitTo:8">
            </div>
            <div class="well well-sm" style="margin-bottom: 20px">
                <small class="text-muted">
                    <b>About searching:</b>
                    Terms include: girl, attribute, skill type, main unit, subunit. Also supported: English
                    <a href="https://schoolido.lu">schoolido.lu</a>
                    set name.</small>
            </div>
        </div>
        <div class="table-responsive" id="tbl">
            <table class="table table-striped">
                <thead fsm-sticky-header scroll-body="#tbl" scroll-stop='0'>
                    <tr style="background-color: #fff;overflow:auto">
                        <th>Rank</th>
                        <th class="num-header" ng-click="sortBy('id')">ID
                            <i ng-show="sort.desc && sort.type=='id'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.type=='id'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th>Card Name</th>
                        <th class="num-header" ng-click="sortBy('smile')">Smile
                            <i ng-show="sort.desc && sort.gen=='smile'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.gen=='smile'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" ng-click="sortBy('pure')">Pure
                            <i ng-show="sort.desc && sort.gen=='pure'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.gen=='pure'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" ng-click="sortBy('cool')">Cool
                            <i ng-show="sort.desc && sort.gen=='cool'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.gen=='cool'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" style="min-width:80px" ng-click="sortBy('cScore')">C-Score
                            <i ng-show="sort.desc && sort.gen=='cScore'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.gen=='cScore'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" style="min-width:90px" ng-click="sortBy('oScore')">O-Score
                            <i ng-show="sort.desc && sort.gen=='oScore'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.gen=='oScore'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" style="min-width:90px" ng-click="sortBy('skill.su')" ng-show="filters.compare=='scorers'">Score Up
                            <i ng-show="sort.desc && sort.type=='skill.su'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.type=='skill.su'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" style="min-width:90px" ng-click="sortBy('skill.pl')" ng-show="filters.compare=='perfect locks'">PL Time
                            <i ng-show="sort.desc && sort.type=='skill.pl'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.type=='skill.pl'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" style="min-width:90px" ng-click="sortBy('skill.hl')" ng-show="filters.compare=='healers'">Avg. Heal
                            <i ng-show="sort.desc && sort.type=='skill.hl'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.type=='skill.hl'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" style="min-width:100px" ng-click="sortBy('skill.hl_heel')" ng-show="filters.compare=='healers'">
                            <abbr title="Score Up">SU</abbr>
                            w/ Heel
                            <i ng-show="sort.desc && sort.type=='skill.hl_heel'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.type=='skill.hl_heel'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header" style="min-width:130px" ng-click="sortBy('cScore_heel')" ng-show="filters.compare=='healers'">
                            C-Score w/ Heel
                            <i ng-show="sort.desc && sort.gen=='cScore_heel'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.gen=='cScore_heel'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                        <th class="num-header score-header" style="min-width:130px" ng-click="sortBy('oScore_heel')" ng-show="filters.compare=='healers'">
                            O-Score w/ Heel
                            <i ng-show="sort.desc && sort.gen=='oScore_heel'" class="glyphicon glyphicon-chevron-down"></i>
                            <i ng-show="!sort.desc && sort.gen=='oScore_heel'" class="glyphicon glyphicon-chevron-up"></i>
                        </th>
                    </tr>
                </thead>

                <tbody>
                    <tr ng-if="cards.length==0">
                        <td colspan=15 style="word-wrap: normal">
                            <span class="text-danger">No cards found.</span>
                            <span ng-if="filters.event && filters.compare=='healers'">There are no Healer Event cards.</span>
                            <span ng-show="err.rarity || err.main || err.origin">Please select a(n):
                                <span ng-show="err.rarity">
                                    <b>rarity</b>
                                    (SR, SSR, UR)<span ng-show="err.rarity && (err.main || err.origin)">,
                                    </span>
                                    <span ng-hide="err.rarity && (err.main || err.origin)">.</span>
                                </span>
                                <span ng-show="err.main">
                                    <b>main unit</b>
                                    (μ's, Aqours)<span ng-show="err.main && err.origin">,
                                    </span>
                                    <span ng-hide="err.main && err.origin">.</span>
                                </span>

                                <span ng-show="err.origin">
                                    <b>origin</b>
                                    (Premium, Event, Promo).</span>
                            </span>
                            <span ng-hide="err.rarity || err.main || err.origin">Please check your search string and filters.</span>
                            <a style="cursor: pointer" ng-click="resetFilters()">Reset filters?</a>
                        </td>
                    </tr>
                    <tr ng-repeat="card in cards| filter:search | orderBy:sort.type:sort.desc">
                        <td>{{sort.desc ? $index+1 : cards.length - $index}}</td>
                        <td>{{card.id}}</td>
                        <td class="name-display"><img ng-src="{{filters.idlz || card.is_promo ? card.round_card_idolized_image : card.round_card_image}}" class="display-image">
                            <span
                                uib-popover="This card's skill is dependent on team strength. C-Score, O-Score, and Score Up value may be innaccuate. See Info page for more detailed explanation."
                                popover-title="Disclaimer"
                                popover-trigger="'mouseenter'"
                                popover-enable="card.full_name=='SR Animal Yazawa Nico'||card.full_name=='SR Health Committee Minami Kotori'||card.full_name=='SR Animal Kousaka Honoka'">
                                <span ng-if="card.full_name=='SR Animal Yazawa Nico'||card.full_name=='SR Health Committee Minami Kotori'||card.full_name=='SR Animal Kousaka Honoka'">
                                    <i class="fa fa-info-circle"></i>
                                </span>
                                <a href="{{card.website_url}}">
                                    <i ng-if="card.skill.type=='Score Up'" class="fa fa-level-up" uib-tooltip="Score Up"></i>
                                    <i ng-if="card.skill.type=='Healer'" class="fa fa-heart" uib-tooltip="Healer"></i>
                                    <i ng-if="card.skill.type=='Perfect Lock'" class="fa fa-lock" uib-tooltip="Perfect Lock"></i>
                                    <i ng-if="card.event" class="fa fa-star" uib-tooltip="Event Only"></i>
                                    {{card.full_name}}</a>
                            </span>
                        </td>
                        <td>{{filters.idlz ? card.idolized_maximum_statistics_smile : card.non_idolized_maximum_statistics_smile}}</td>
                        <td>{{filters.idlz ? card.idolized_maximum_statistics_pure : card.non_idolized_maximum_statistics_pure}}</td>
                        <td>{{filters.idlz ? card.idolized_maximum_statistics_cool : card.non_idolized_maximum_statistics_cool}}</td>
                        <td>{{filters.idlz ? card.cScore_idlz : card.cScore | number:2}}</td>
                        <td>{{filters.idlz ? card.oScore_idlz : card.oScore | number:2}}</td>
                        <td ng-show="filters.compare=='scorers'">{{card.skill.su |number:2}}</td>
                        <td ng-show="filters.compare=='perfect locks'">{{card.skill.pl |number:2}}</td>
                        <td ng-show="filters.compare=='healers'">{{card.skill.hl | number:2}}</td>
                        <td ng-show="filters.compare=='healers'">{{card.skill.hl_heel |number:2}}</td>
                        <td ng-show="filters.compare=='healers'">
                          <span uib-popover="Cannot equip Heel to an unidolized SR or SSR. Turn on Idolized." popover-trigger="'mouseenter'" popover-enable="!filters.idlz && card.cScore_heel==0">
                                    <i ng-if="!filters.idlz && card.cScore_heel==0" class="fa fa-warning text-danger"></i>
                                {{filters.idlz ? card.cScore_heel_idlz : card.cScore_heel | number:2}}
                              </span>
                              </td>
                            <td ng-show="filters.compare=='healers'">
                          <span uib-popover="Cannot equip Heel to an unidolized SR or SSR. Turn on Idolized." popover-trigger="'mouseenter'" popover-enable="!filters.idlz && card.cScore_heel==0">
                                    <i ng-if="!filters.idlz && card.cScore_heel==0" class="fa fa-warning text-danger"></i>
                                {{filters.idlz ? card.oScore_heel_idlz : card.oScore_heel | number:2}}</td>
                              </span>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
