<div class="container-fluid row">
    <div class="col-xs-2" id="filters-md-screens">
        <div class="row">
            <div class="btn-group-vertical col-xs-12" uib-tooltip="Skill" tooltip-placement="top">
                <label class="btn btn-success btn-sm" ng-model="userFilters.compare" ng-click="filterCards()" uib-btn-radio="'scorers'">Score Up</label>
                <label class="btn btn-success btn-sm" ng-model="userFilters.compare" ng-click="filterCards()" uib-btn-radio="'perfect locks'">Perfect Lock</label>
                <label class="btn btn-success btn-sm" ng-model="userFilters.compare" ng-click="filterCards()" uib-btn-radio="'healers'">Healer</label>
            </div>

            <div class="btn-group btn-group-justified">
                <label class="btn btn-danger btn-sm" ng-click="resetFilters()">Reset Filters</label>
            </div>
            <div class="btn-group-vertical col-xs-12">
                <label class="btn btn-info btn-sm" ng-model="userFilters.displayImg" ng-click="setLocalStorageFilters()" uib-btn-checkbox>Display images?</label>
            </div>

            <div uib-tooltip="Attribute" tooltip-placement="top">
                <div class="btn-group btn-group-justified col-xs-12 no-padding" style="margin-bottom:0px">
                    <label class="btn btn-info btn-sm" style="border-bottom-left-radius:0" ng-model="userFilters.attribute" ng-click="filterCards()" uib-btn-radio="'all'">All</label>
                    <label class="btn btn-info btn-sm" style="border-bottom-right-radius:0" ng-model="userFilters.attribute" ng-click="filterCards()" uib-btn-radio="'smile'">Smile</label>
                </div>

                <div class="btn-group btn-group-justified col-xs-12 no-padding">
                    <label class="btn btn-info btn-sm" style="border-top-left-radius:0" ng-model="userFilters.attribute" ng-click="filterCards()" uib-btn-radio="'pure'">Pure</label>
                    <label class="btn btn-info btn-sm" style="border-top-right-radius:0" ng-model="userFilters.attribute" ng-click="filterCards()" uib-btn-radio="'cool'">Cool</label>
                </div>
            </div>

            <div class="btn-group btn-group-justified col-xs-12" uib-tooltip="Rarity" tooltip-placement="top">
                <label class="btn btn-info btn-sm" ng-model="userFilters.sr" ng-click="toggleBool(userFilters.sr);filterCards()" uib-btn-checkbox>SR</label>
                <label class="btn btn-info btn-sm" ng-model="userFilters.ssr" ng-click="toggleBool(userFilters.ssr);filterCards()" uib-btn-checkbox>SSR</label>
                <label class="btn btn-info btn-sm" ng-model="userFilters.ur" ng-click="toggleBool(userFilters.ur);filterCards()" uib-btn-checkbox>UR</label>
            </div>

            <div class="btn-group-vertical col-xs-12" uib-tooltip="Origin" tooltip-placement="top">
                <label class="btn btn-info btn-sm" ng-model="userFilters.premium" ng-click="toggleBool(userFilters.premium);filterCards()" uib-btn-checkbox>Premium</label>
                <label class="btn btn-info btn-sm" ng-model="userFilters.event" ng-click="toggleBool(userFilters.event);filterCards()" uib-btn-checkbox>Event</label>
                <label class="btn btn-info btn-sm" ng-model="userFilters.promo" ng-click="toggleBool(userFilters.promo);filterCards()" uib-btn-checkbox>Promo</label>
            </div>

            <div class="btn-group-vertical col-xs-12" uib-tooltip="Main unit" tooltip-placement="top">
                <label class="btn btn-info btn-sm" ng-model="userFilters.muse" ng-click="toggleBool(userFilters.muse);filterCards()" uib-btn-checkbox>Muse</label>
                <label class="btn btn-info btn-sm" ng-model="userFilters.aqours" ng-click="toggleBool(userFilters.aqours);filterCards()" uib-btn-checkbox>Aqours</label>
            </div>

            <small class="col-xs-12">
                Showing
                <b>{{filtered.length}}</b>
                of
                <b>{{rawUserCards ? rawUserCards.length : 0}}</b>
                total cards.
            </small>
        </div>
    </div>

    <div id="search_table" class="col-xs-10" bs-loading-overlay bs-loading-overlay-reference-id="accounts">

        <div id="search" class="row">

            <div class="col-xs-12 no-padding">
                <div class="col-xs-7">
                    <form name="username">
                        <div class="form-group input-group input-group-sm" ng-class="{'has-error': (username.un.$touched && username.un.$error.required)}">
                            <input type="text" class="form-control" ng-model="sit.user" name="un" placeholder="schoolido.lu username" ng-change="updateUser()" required>
                            <div class="input-group-btn">
                                <button type="submit" class="btn" uib-dropdown-toggle ng-disabled="username.un.$error.required || sit.user==''" ng-click="getAccounts()">
                                    Get accounts
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-xs-5">
                    <div class="input-group input-group-sm">
                        <select class="form-control" ng-model="sit.chosenAccount" ng-blur="chooseAccount()" ng-options="acc.name for acc in sit.accounts track by acc.id"></select>
                        <div class="input-group-btn">
                            <button type="button" class="btn" ng-click="getCards()" ng-disabled="sit.accErr || sit.accounts.length<=1 || sit.chosenAccount.id == ''">Get cards</button>
                        </div>
                    </div>
                </div>

            </div>

            <div class="col-xs-12">
                <div class="input-group input-group-sm">
                    <span class="input-group-addon">
                        <i class="fa fa-search"></i>
                    </span>
                    <input type="text" class="form-control" ng-model="userSearch" ng-change="updateSearch()" placeholder="search by card" uib-typeahead="type for type in $root.Typeahead | filter:$viewValue | limitTo:8">
                    <span class="input-group-addon" style="cursor: pointer" popover-append-to-body="true" popover-placement="top-right" uib-popover="Terms include: girl, attribute, skill type, main unit, subunit, and English schoolido.lu set name.">
                        <i class="fa fa-info"></i>
                    </span>

                </div>
              </div>
        </div>

        <div style="border: 1px solid #dfd7ca;border-radius: 3px;position:relative" bs-loading-overlay bs-loading-overlay-reference-id="table">
            <div class="table-container user-table">

                <table class="table table-striped" id="tbl">
                    <thead fix-head>
                        <tr ng-show="filtered.length!=0">
                            <th>Rank</th>
                            <th class="name-display">Card Name</th>
                            <th class="num-header" ng-click="sortBy('id')">ID
                                <i ng-show="sort.desc && sort.type=='id'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='id'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" ng-click="sortBy('max_smile')">Smile
                                <i ng-show="sort.desc && sort.type=='max_smile'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='max_smile'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" ng-click="sortBy('max_pure')">Pure
                                <i ng-show="sort.desc && sort.type=='max_pure'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='max_pure'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" ng-click="sortBy('max_cool')">Cool
                                <i ng-show="sort.desc && sort.type=='max_cool'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='max_cool'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:80px" ng-click="sortBy('cScore')">C-Score
                                <i ng-show="sort.desc && sort.gen=='cScore'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.gen=='cScore'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:90px" ng-click="sortBy('oScore')">O-Score
                                <i ng-show="sort.desc && sort.gen=='oScore'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.gen=='oScore'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:90px" ng-click="sortBy('skill.su')" ng-show="userFilters.compare=='scorers'">Score Up
                                <i ng-show="sort.desc && sort.type=='skill.su'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='skill.su'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:90px" ng-click="sortBy('skill.pl')" ng-show="userFilters.compare=='perfect locks'">PL Time
                                <i ng-show="sort.desc && sort.type=='skill.pl'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='skill.pl'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:90px" ng-click="sortBy('skill.hl')" ng-show="userFilters.compare=='healers'">Avg. Heal
                                <i ng-show="sort.desc && sort.type=='skill.hl'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='skill.hl'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:100px" ng-click="sortBy('skill.hl_heel')" ng-show="userFilters.compare=='healers'">
                                <abbr title="Score Up">SU</abbr>
                                w/ Heel
                                <i ng-show="sort.desc && sort.type=='skill.hl_heel'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.type=='skill.hl_heel'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header" style="min-width:130px" ng-click="sortBy('cScore_heel')" ng-show="userFilters.compare=='healers'">
                                C-Score w/ Heel
                                <i ng-show="sort.desc && sort.gen=='cScore_heel'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.gen=='cScore_heel'" class="fa fa-chevron-up"></i>
                            </th>
                            <th class="num-header score-header" style="min-width:130px" ng-click="sortBy('oScore_heel')" ng-show="userFilters.compare=='healers'">
                                O-Score w/ Heel
                                <i ng-show="sort.desc && sort.gen=='oScore_heel'" class="fa fa-chevron-down"></i>
                                <i ng-show="!sort.desc && sort.gen=='oScore_heel'" class="fa fa-chevron-up"></i>
                            </th>
                        </tr>
                    </thead>

                    <tbody>
                        <!-- <tr><td class="text-left"><pre>{{userCards|json}}</pre></td></tr> -->
                        <tr ng-if="">
                            <td>
                                <b class="text-danger">Error getting accounts.</b>
                                Check that
                                <a href="http://schoolido.lu">schoolido.lu</a>
                                is online, your username is correct, and the account you've selected has SR+ cards.</td>
                        </tr>
                        <tr ng-if="userCards.length==0">
                            <td>Enter your
                                <a href="http://schoolido.lu">schoolido.lu</a>
                                username and press
                                <b>Get Accounts</b>. Choose an account and press
                                <b>Get Cards</b>.
                              </td>
                        </tr>

                        <tr ng-if="!userCards || filtered.length==0 && sit.chosenAccount.id != '' && grabbedCards">
                            <td colspan=15 style="word-wrap: normal">
                                <span class="text-danger">No cards found.</span>
                                <!-- <span ng-if="userFilters.event && userFilters.compare=='healers'">There are no Healer Event cards.</span> -->
                                <span ng-show="err.rarity || err.main || err.origin">Please select a(n):
                                    <span ng-show="err.rarity">
                                        <b>rarity</b>
                                        (SR, SSR, UR)<span ng-show="err.rarity && (err.main || err.origin)">,
                                        </span>
                                        <span ng-hide="err.rarity && (err.main || err.origin)">.</span>
                                    </span>
                                    <span ng-show="err.main">
                                        <b>main unit</b>
                                        (μ's, Aqours)<span ng-show="err.main && err.origin">,
                                        </span>
                                        <span ng-hide="err.main && err.origin">.</span>
                                    </span>

                                    <span ng-show="err.origin">
                                        <b>origin</b>
                                        (Premium, Event, Promo).</span>
                                </span>
                                <span ng-hide="err.rarity || err.main || err.origin">Please check your search string and filters.</span>
                                <a style="cursor: pointer" ng-click="resetFilters()">Reset filters?</a>
                            </td>
                        </tr>
                        <tr ng-repeat="card in filtered = (userCards | filter:userSearch) | orderBy:sort.type:sort.desc track by $index ">
                            <td>{{sort.desc ? $index+1 : filtered.length - $index}}</td>
                            <td class="name-display">
                                <div class="media">
                                    <div class="media-left"><img ng-if="userFilters.displayImg" ng-src="{{card.user_idlz || card.is_promo ? card.round_card_idolized_image : card.round_card_image}}" class="display-image media-image">
                                    </div>
                                    <div class="media-body media-middle">
                                        <span
                                            uib-popover="This card's skill is dependent on team strength. C-Score, O-Score, and Score Up value may be innaccuate. See Info page for more detailed explanation."
                                            popover-title="Disclaimer"
                                            popover-trigger="'mouseenter'"
                                            popover-enable="card.full_name=='SR Animal Yazawa Nico'||card.full_name=='SR Health Committee Minami Kotori'||card.full_name=='SR Animal Kousaka Honoka'">
                                            <span ng-if="card.full_name=='SR Animal Yazawa Nico'||card.full_name=='SR Health Committee Minami Kotori'||card.full_name=='SR Animal Kousaka Honoka'">
                                                <i class="fa fa-info-circle"></i>
                                            </span>
                                            <a href="{{card.website_url}}" ng-class="{'text-smile': card.attribute=='Smile', 'text-pure': card.attribute=='Pure', 'text-cool': card.attribute=='Cool'}">
                                                <i ng-if="card.skill.type=='Score Up'" class="fa fa-level-up" uib-tooltip="Score Up"></i>
                                                <i ng-if="card.skill.type=='Healer'" class="fa fa-heart" uib-tooltip="Healer"></i>
                                                <i ng-if="card.skill.type=='Perfect Lock'" class="fa fa-lock" uib-tooltip="Perfect Lock"></i>
                                                <i ng-if="card.event" class="fa fa-star" uib-tooltip="Event Only"></i>
                                                {{card.full_name}}</a>
                                        </span>
                                    </div>
                                </div>
                            </td>
                            <td>{{card.id}}</td>
                            <td>{{card.max_smile}}</td>
                            <td>{{card.max_pure}}</td>
                            <td>{{card.max_cool}}</td>
                            <td>{{card.cScore | number:2}}</td>
                            <td>{{card.oScore | number:2}}</td>
                            <td ng-show="userFilters.compare=='scorers'">{{card.skill.su |number:2}}</td>
                            <td ng-show="userFilters.compare=='perfect locks'">{{card.skill.pl |number:2}}</td>
                            <td ng-show="userFilters.compare=='healers'">{{card.skill.hl | number:2}}</td>
                            <td ng-show="userFilters.compare=='healers'">{{card.skill.hl_heel |number:2}}</td>
                            <td ng-show="userFilters.compare=='healers'">
                                <span uib-popover="Cannot equip Heel to an unidolized SR or SSR. Turn on Idolized." popover-trigger="'mouseenter'" popover-enable="card.cScore_heel==0">
                                    <i ng-if="card.cScore_heel==0" class="fa fa-warning text-danger"></i>
                                    {{card.cScore_heel | number:2}}
                                </span>
                            </td>
                            <td ng-show="userFilters.compare=='healers'">
                                <span uib-popover="Cannot equip Heel to an unidolized SR or SSR. Turn on Idolized." popover-trigger="'mouseenter'" popover-enable="card.oScore_heel==0">
                                    <i ng-if="card.oScore_heel==0" class="fa fa-warning text-danger"></i>
                                    {{card.oScore_heel | number:2}}</td>
                            </span>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>
